# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å VK ID

## –ü—Ä–æ–±–ª–µ–º–∞
VK ID –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `localhost:3000` –¥–ª—è callback URLs. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –¥–æ–º–µ–Ω —Å HTTPS.

## –†–µ—à–µ–Ω–∏–µ: —Ç—É–Ω–Ω–µ–ª—å —á–µ—Ä–µ–∑ ngrok

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok
```bash
# Windows (—á–µ—Ä–µ–∑ Chocolatey)
choco install ngrok

# –ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å https://ngrok.com/download
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—É–Ω–Ω–µ–ª—è
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
ngrok http 3000
```

–ü–æ–ª—É—á–∏—Ç–µ URL –≤–∏–¥–∞: `https://abc123.ngrok.io`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VK ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ [VK ID Business](https://id.vk.ru/business/go)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (ID: 54017823)
3. –í —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" ‚Üí "–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–π Redirect URL":
   - –î–æ–±–∞–≤—å—Ç–µ: `https://abc123.ngrok.io/api/auth/vk/callback`
4. –í "–ë–∞–∑–æ–≤—ã–π –¥–æ–º–µ–Ω":
   - –î–æ–±–∞–≤—å—Ç–µ: `abc123.ngrok.io`

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–í —Ñ–∞–π–ª–µ `backend/.env`:
```env
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ngrok URL
NEXTAUTH_URL=https://abc123.ngrok.io
NEXT_PUBLIC_APP_URL=https://abc123.ngrok.io
VKID_REDIRECT_URL=https://abc123.ngrok.io/api/auth/vk/callback
```

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ CLIENT_SECRET
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö VK ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞–π–¥–∏—Ç–µ "–°–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞"
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ `.env`:
```env
VKID_CLIENT_SECRET=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç
```

### 6. –ó–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: ngrok —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (backend + frontend)
cd backend
npm run dev
```

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://abc123.ngrok.io` (–≤–∞—à ngrok URL)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ VK ID –≤–∏–¥–∂–µ—Ç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: cloudflared

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install -g cloudflared

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç—É–Ω–Ω–µ–ª—è
cloudflared tunnel --url http://localhost:3000
```

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ logs
```bash
# Backend logs
tail -f backend/logs/app.log

# –ò–ª–∏ –≤ –∫–æ–¥–µ:
console.log('VK ID callback received:', { code, state, signature });
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
- **Invalid redirect_uri**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –≤ VK ID —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `VKID_REDIRECT_URL`
- **Invalid signature**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `VKID_CLIENT_SECRET` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- **State mismatch**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é state –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/auth/vk/callback`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `code`, `state`, `signature`, `device_id`

## –ü—Ä–æ–¥–∞–∫—à–Ω

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
1. –†–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –≤ VK ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±–µ–∑ ngrok URL