# üîî –ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ESG-–õ–∞–π—Ç

**–î–∞—Ç–∞**: 2025-09-30
**–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (UI –≥–æ—Ç–æ–≤, backend —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

#### 1. **UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (Settings.tsx)
- ‚úÖ –í–∫–ª–∞–¥–∫–∞ "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" —Å –ø–æ–ª–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- ‚úÖ **–°–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏**:
  - Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
  - Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
- ‚úÖ **–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
  - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –æ—Ç—á–µ—Ç–æ–≤
  - –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤ (30, 7, 1 –¥–µ–Ω—å)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ React state (–ª–æ–∫–∞–ª—å–Ω–æ)

#### 2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** (Prisma schema)
- ‚úÖ –ú–æ–¥–µ–ª—å `Notification` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  ```prisma
  model Notification {
    id        String   @id @default(cuid())
    userId    String
    type      String   // document_data_edited, document_correction_submitted, etc.
    title     String
    message   String
    metadata  Json?
    read      Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    user      User     @relation(fields: [userId], references: [id])
  }
  ```

#### 3. **Email –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- ‚úÖ RuSender –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (`lib/rusender.ts`)
- ‚úÖ Universal email service (`lib/email-universal.ts`)
- ‚úÖ Magic Link —á–µ—Ä–µ–∑ email (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ Email —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ü–µ–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`lib/email-service.ts`)
- ‚úÖ Manager notification —Å–∏—Å—Ç–µ–º–∞ (`lib/manager-notification.ts`)

#### 4. **–°–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (lib/pricing-notifications.ts)
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–µ–∑–æ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Ü–µ–Ω
- ‚úÖ Email —à–∞–±–ª–æ–Ω—ã (surge_start, surge_end, discount)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RuSender

---

## ‚ùå –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:

### 1. **NotificationPreferences –º–æ–¥–µ–ª—å** (Prisma)
‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±—É–µ—Ç—Å—è**:
```prisma
model NotificationPreferences {
  id               String   @id @default(cuid())
  userId           String   @unique

  // –ö–∞–Ω–∞–ª—ã –¥–æ—Å—Ç–∞–≤–∫–∏
  emailEnabled     Boolean  @default(true)
  pushEnabled      Boolean  @default(false)

  // –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  reportsEnabled   Boolean  @default(true)
  deadlinesEnabled Boolean  @default(true)
  documentsEnabled Boolean  @default(false)

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  deadlineDays     Int[]    @default([30, 7, 1]) // –ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —É–≤–µ–¥–æ–º–ª—è—Ç—å
  quietHoursStart  Int?     // –¢–∏—Ö–∏–µ —á–∞—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  quietHoursEnd    Int?
  timezone         String   @default("Europe/Moscow")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}
```

### 2. **API endpoints –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫**
‚ùå `GET /api/settings/notifications` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚ùå `PUT /api/settings/notifications` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–¢—Ä–µ–±—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ –ë–î (–∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DEMO —Ä–µ–∂–∏–º–∞

### 3. **API endpoints –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
‚ùå `GET /api/notifications` - —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚ùå `GET /api/notifications/unread-count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
‚ùå `PATCH /api/notifications/[id]/read` - –æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
‚ùå `PATCH /api/notifications/mark-all-read` - –æ—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏
‚ùå `DELETE /api/notifications/[id]` - —É–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### 4. **Notification Service** (lib/notification-service.ts)
‚ùå –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–¢—Ä–µ–±—É–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
```typescript
class NotificationService {
  // –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  async createNotification(params: {
    userId: string;
    type: NotificationType;
    title: string;
    message: string;
    metadata?: Record<string, any>;
  }): Promise<Notification>

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
  async sendNotification(
    userId: string,
    notification: Notification
  ): Promise<void>

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async shouldSendNotification(
    userId: string,
    type: NotificationType,
    channel: 'email' | 'push'
  ): Promise<boolean>
}
```

### 5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ API**
‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–∞ (`/api/reports/[id]/submit`)
‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (`/api/documents/upload`, worker)
‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–∞—Ö (cron job)
‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 6. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
‚ùå Dropdown/Popover —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ header
‚ùå –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (badge —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º)
‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ (`/notifications`)

### 7. **Web Push Notifications**
‚ùå VAPID –∫–ª—é—á–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Service Worker
‚ùå –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚ùå –û—Ç–ø—Ä–∞–≤–∫–∞ push —á–µ—Ä–µ–∑ Web Push API

---

## üéØ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### –§–∞–∑–∞ 1: Backend –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (PAID —Ä–µ–∂–∏–º)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Prisma –¥–ª—è `NotificationPreferences`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GET/PUT /api/settings/notifications`
3. ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—å Settings.tsx –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É API
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å `NotificationService` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ë–î
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GET /api/notifications` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
6. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `PATCH /api/notifications/[id]/read` –∏ bulk –æ–ø–µ—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 2: Email –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
7. ‚úÖ –°–æ–∑–¥–∞—Ç—å email —à–∞–±–ª–æ–Ω—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –æ—Ç—á–µ—Ç–∞
   - –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–∞
   - –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
8. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å NotificationService —Å RuSender
9. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API
10. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ `/api/documents/upload` (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
11. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ OCR worker –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
12. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ `/api/reports/[id]/submit` –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–∞
13. ‚úÖ –°–æ–∑–¥–∞—Ç—å cron job –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤

### –§–∞–∑–∞ 4: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
14. ‚úÖ –°–æ–∑–¥–∞—Ç—å `NotificationBell.tsx` –≤ header —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º
15. ‚úÖ –°–æ–∑–¥–∞—Ç—å dropdown —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
16. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/notifications` —Å–æ –≤—Å–µ–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
17. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã: –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ/–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ, –ø–æ —Ç–∏–ø—É

### –§–∞–∑–∞ 5: Web Push (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
18. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VAPID –∫–ª—é—á–∏
19. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Service Worker –¥–ª—è push
20. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ push –≤ Settings
21. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É push –≤ NotificationService

---

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–µ–º–æ vs PAID —Ä–µ–∂–∏–º
- **DEMO —Ä–µ–∂–∏–º**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å 3-5 –º–æ–∫–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ
- **PAID —Ä–µ–∂–∏–º**: –†–µ–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ –ë–î, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î, email –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ RuSender

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```typescript
enum NotificationType {
  REPORT_READY = 'report_ready',
  REPORT_SUBMITTED = 'report_submitted',
  DEADLINE_30_DAYS = 'deadline_30_days',
  DEADLINE_7_DAYS = 'deadline_7_days',
  DEADLINE_1_DAY = 'deadline_1_day',
  DOCUMENT_PROCESSED = 'document_processed',
  DOCUMENT_ERROR = 'document_error',
  PRICING_SURGE_START = 'pricing_surge_start',
  PRICING_SURGE_END = 'pricing_surge_end',
  TRIAL_REQUEST_STATUS = 'trial_request_status',
}
```

### Email templates —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º ESG-–õ–∞–π—Ç
- –ò–∫–æ–Ω–∫–∞ —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
- –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (–ø–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ç—á–µ—Ç—É/–¥–æ–∫—É–º–µ–Ω—Ç—É)
- Footer —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Rate limiting –¥–ª—è API —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –≤ metadata

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Response formats

**GET /api/notifications**
```typescript
{
  notifications: Array<{
    id: string;
    type: NotificationType;
    title: string;
    message: string;
    metadata?: Record<string, any>;
    read: boolean;
    createdAt: string;
  }>;
  pagination: {
    total: number;
    page: number;
    pageSize: number;
    hasMore: boolean;
  };
  unreadCount: number;
}
```

**GET /api/settings/notifications**
```typescript
{
  emailEnabled: boolean;
  pushEnabled: boolean;
  reportsEnabled: boolean;
  deadlinesEnabled: boolean;
  documentsEnabled: boolean;
  deadlineDays: number[];
  quietHoursStart?: number;
  quietHoursEnd?: number;
  timezone: string;
}
```

### –ò–Ω–¥–µ–∫—Å—ã –ë–î (–¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
```sql
CREATE INDEX idx_notifications_user_read ON notifications(userId, read);
CREATE INDEX idx_notifications_user_created ON notifications(userId, createdAt DESC);
CREATE INDEX idx_notifications_type ON notifications(type);
```

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç |
|-----------|--------|--------------|
| Prisma –º–æ–¥–µ–ª—å | ‚ùå | 15 –º–∏–Ω |
| API –Ω–∞—Å—Ç—Ä–æ–µ–∫ | ‚ùå | 1 —á–∞—Å |
| API —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | ‚ùå | 2 —á–∞—Å–∞ |
| NotificationService | ‚ùå | 2 —á–∞—Å–∞ |
| Email –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚úÖ (—á–∞—Å—Ç–∏—á–Ω–æ) | 1 —á–∞—Å |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API | ‚ùå | 3 —á–∞—Å–∞ |
| UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | ‚ùå | 4 —á–∞—Å–∞ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚ùå | 2 —á–∞—Å–∞ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: 15-16 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## ‚úÖ Checklist –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ 7

- [ ] –°–æ–∑–¥–∞—Ç—å NotificationPreferences –º–æ–¥–µ–ª—å –≤ Prisma
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API GET/PUT /api/settings/notifications
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Settings.tsx –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É API
- [ ] –°–æ–∑–¥–∞—Ç—å NotificationService
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API GET /api/notifications
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API PATCH –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å email —à–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ /api/documents/upload
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ OCR worker
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ /api/reports/[id]/submit
- [ ] –°–æ–∑–¥–∞—Ç—å cron job –¥–ª—è –¥–µ–¥–ª–∞–π–Ω–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å NotificationBell –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- [ ] –°–æ–∑–¥–∞—Ç—å dropdown —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É /notifications
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è DEMO —Ä–µ–∂–∏–º–∞
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è NotificationService
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è UI —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

**–í—ã–≤–æ–¥**: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç (UI –≥–æ—Ç–æ–≤, email –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ—Å—Ç—å), –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ backend —á–∞—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ PAID —Ä–µ–∂–∏–º–µ. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –§–∞–∑—ã 1-3 –¥–ª—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.