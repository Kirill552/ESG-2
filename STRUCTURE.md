# üì¶ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ESG-2 Backend

## ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```
backend/lib/
‚îú‚îÄ‚îÄ auth-options.ts           # NextAuth –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ webauthn.ts              # Passkeys/Face ID –ø–æ–¥–¥–µ—Ä–∂–∫–∞  
‚îú‚îÄ‚îÄ rate-limiter.ts          # Rate limiting + –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤
‚îú‚îÄ‚îÄ email-service.ts         # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email
‚îî‚îÄ‚îÄ rusender.ts              # RUSENDER –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```

### ü§ñ OCR –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```
backend/lib/
‚îú‚îÄ‚îÄ multi-level-ocr-service.ts       # üî• –ì–ª–∞–≤–Ω—ã–π OCR –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ yandex-vision-service.ts         # Yandex Vision API
‚îú‚îÄ‚îÄ yandex-iam-token-manager.ts      # IAM —Ç–æ–∫–µ–Ω—ã
‚îú‚îÄ‚îÄ ocr.ts                          # Tesseract fallback
‚îú‚îÄ‚îÄ foundation-models-client.ts      # Cloud.ru Foundation Models
‚îú‚îÄ‚îÄ enhanced-extraction-service.ts   # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ESG –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ intelligent-file-processor.ts    # –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ simplified-ocr-service.ts        # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π OCR
‚îú‚îÄ‚îÄ contextual-analysis-service.ts   # –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚îî‚îÄ‚îÄ parsers/                        # 10 —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤
    ‚îú‚îÄ‚îÄ base-parser.ts
    ‚îú‚îÄ‚îÄ csv-parser.ts
    ‚îú‚îÄ‚îÄ excel-parser.ts
    ‚îú‚îÄ‚îÄ pdf-parser.ts
    ‚îî‚îÄ‚îÄ ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
```

### üìä –û—Ç—á–µ—Ç—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
```
backend/lib/
‚îú‚îÄ‚îÄ enhanced-report-generator.ts     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ 296-–§–ó
‚îú‚îÄ‚îÄ format-detector.ts              # –î–µ—Ç–µ–∫—Ç–æ—Ä —Ñ–æ—Ä–º–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ synonym-dictionary.ts           # –≠–°–ì —Å–ª–æ–≤–∞—Ä—å
‚îú‚îÄ‚îÄ russian-document-patterns.ts    # –†–æ—Å—Å–∏–π—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
‚îî‚îÄ‚îÄ supported-file-types.ts         # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
```

### ‚öôÔ∏è –û—á–µ—Ä–µ–¥–∏ –∏ —Å–∏—Å—Ç–µ–º–∞
```
backend/lib/
‚îú‚îÄ‚îÄ queue.ts                        # PostgreSQL –æ—á–µ—Ä–µ–¥–∏ (pg-boss)
‚îú‚îÄ‚îÄ logger.ts                       # –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ structured-logger.ts            # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
‚îú‚îÄ‚îÄ prisma.ts                       # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ s3.ts                          # Yandex Object Storage
‚îú‚îÄ‚îÄ text-utils.ts                  # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞
‚îî‚îÄ‚îÄ utils.ts                       # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

backend/workers/
‚îî‚îÄ‚îÄ ocr-worker.ts                   # OCR background worker
```

### üèóÔ∏è API –º–∞—Ä—à—Ä—É—Ç—ã (–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä)
```
backend/app/api/
‚îú‚îÄ‚îÄ auth/                           # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ [...nextauth]/             # NextAuth provider
‚îÇ   ‚îú‚îÄ‚îÄ check-user/                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ clear-session/             # –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ magic-link/                # Magic links
‚îÇ   ‚îî‚îÄ‚îÄ webauthn/                  # Passkeys API
‚îú‚îÄ‚îÄ ocr/                           # OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ route.ts                   # –û—Å–Ω–æ–≤–Ω–æ–π OCR API
‚îÇ   ‚îî‚îÄ‚îÄ ...                       # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îú‚îÄ‚îÄ reports/                       # –û—Ç—á–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ [id]/view/                 # –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ [id]/download/             # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
‚îÇ   ‚îî‚îÄ‚îÄ ...                       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞–º–∏
‚îú‚îÄ‚îÄ documents/                     # –î–æ–∫—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ [documentId]/data/         # OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ ...                       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
‚îî‚îÄ‚îÄ queue/                         # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π
    ‚îú‚îÄ‚îÄ health/                    # Health checks
    ‚îî‚îÄ‚îÄ ...                       # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π
```

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∏–ø—ã
```
backend/prisma/
‚îú‚îÄ‚îÄ schema.prisma                   # –ü–æ–ª–Ω–∞—è Prisma —Å—Ö–µ–º–∞
‚îî‚îÄ‚îÄ migrations/                     # –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏

backend/types/
‚îú‚îÄ‚îÄ auth.ts                        # –¢–∏–ø—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ ocr.ts                         # OCR —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ reports.ts                     # –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤
‚îî‚îÄ‚îÄ ...                           # –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã
```

## üöÄ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ü–æ–ª–Ω–∞—è backend —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è OCR —Å–∏—Å—Ç–µ–º–∞** (Yandex + Tesseract + Foundation Models)
- **–†–æ—Å—Å–∏–π—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (VK ID + Magic Links + Passkeys)
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤** (296-–§–ó + CBAM)
- **PostgreSQL –æ—á–µ—Ä–µ–¥–∏** —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
- **152-–§–ó compliance** (—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ + rate limiting)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–ü–æ–ª–Ω—ã–π API** –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É:
- **Prisma —Å—Ö–µ–º–∞ –ë–î** —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- **TypeScript —Ç–∏–ø—ã** –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
- **10+ –ø–∞—Ä—Å–µ—Ä–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** (CSV, Excel, PDF, Office, etc.)
- **Workers —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è background –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Health checks** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –°–æ–∑–¥–∞—Ç—å –∫–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã:
```bash
# –í –∫–æ—Ä–Ω–µ ESG-2/
package.json           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
next.config.js         # Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
tailwind.config.js     # –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
tsconfig.json          # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
.env.example           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
.gitignore             # Git –∏—Å–∫–ª—é—á–µ–Ω–∏—è
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```json
{
  "dependencies": {
    "next": "15.0.0",
    "react": "^18.0.0",
    "next-auth": "^4.24.0",
    "prisma": "^5.0.0",
    "@prisma/client": "^5.0.0",
    "pg-boss": "^10.0.0",
    "tesseract.js": "^6.0.1",
    "@aws-sdk/client-s3": "^3.540.0",
    "exceljs": "^4.4.0",
    "pdf-parse": "^1.1.1",
    "sharp": "^0.33.0"
  }
}
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ENV:
```bash
# Database
DATABASE_URL=postgresql://user:pass@176.108.253.195:5432/db

# NextAuth  
AUTH_SECRET=your_secret
NEXT_PUBLIC_VKID_APP_ID=54017823

# OCR
YANDEX_FOLDER_ID=your_folder_id
ENABLE_YANDEX_VISION=true

# Email
RUSENDER_API_KEY=your_key

# Queue
QUEUE_STORAGE_TYPE=postgres

# 152-–§–ó
FERNET_SECRET=your_fernet_key
```

### 4. –ó–∞–ø—É—Å–∫:
```bash
npm install
npx prisma generate
npx prisma migrate deploy
npm run dev
```

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏—è –≤ ESG-2:
- ‚ùå **–£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è —Ç–∞—Ä–∏—Ñ–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** ‚Äî –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏
- ‚ùå **–£–±—Ä–∞–Ω—ã –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏** ‚Äî —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞
- ‚ùå **–£–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî —Ñ–æ–∫—É—Å –Ω–∞ –±–∞–∑–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è OCR –ª–æ–≥–∏–∫–∞** ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî 152-–§–ó compliance
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Äî VK ID, RUSENDER, Yandex

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
2. **–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî OCR, –æ—Ç—á–µ—Ç—ã, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
3. **–†–æ—Å—Å–∏–π—Å–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã** ‚Äî 296-–§–ó, 152-–§–ó
4. **Production ready** ‚Äî –æ—á–µ—Ä–µ–¥–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. **–õ–µ–≥–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** ‚Äî —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞ –≤–º–µ—Å—Ç–æ —Ç–∞—Ä–∏—Ñ–æ–≤

---

**–ò—Ç–æ–≥:** ESG-2/backend —Å–æ–¥–µ—Ä–∂–∏—Ç **100% –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –∫–æ–¥–∞** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ MVP —Å–∏—Å—Ç–µ–º—ã ESG –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏. –û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.