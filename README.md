# üåø ESG-2: Backend API

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
**ESG-2** ‚Äî —ç—Ç–æ backend API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–≥–ª–µ—Ä–æ–¥–Ω–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –≤ –†–æ—Å—Å–∏–∏. –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å —Å REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±—É–¥—É—â–∏–º–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–µ—à–µ–Ω–∏—è–º–∏.

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Backend
–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π backend –Ω–∞ Node.js —Å PostgreSQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend (–ø–∞–ø–∫–∞ /backend):
‚úÖ **Next.js API Routes** - REST API endpoints  
‚úÖ **NextAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (VK ID, Magic Links, Passkeys)  
‚úÖ **OCR —Å–∏—Å—Ç–µ–º–∞** (GigaChat + Tesseract + Yandex Vision)  
‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤** (296-–§–ó, CBAM, —É–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥)  
‚úÖ **PostgreSQL** —Å Prisma ORM  
‚úÖ **pg-boss** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π  
‚úÖ **152-–§–ó compliance** (Fernet —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)  
‚úÖ **Structured Logging**  
‚úÖ **–†–æ—Å—Å–∏–π—Å–∫–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** (CHECKO API, RUSENDER)  

### –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
‚ùå **Frontend** - —Ç–æ–ª—å–∫–æ API endpoints  
‚ùå **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã** - —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É  
‚ùå **–ë–∏–ª–ª–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã/–æ–ø–ª–∞—Ç—ã
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: VK ID, Magic Links, Passkeys
- **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**: PDF, CSV, Excel, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤**: 296-–§–ó, CBAM, —É–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥
- **–≠–∫—Å–ø–æ—Ä—Ç**: PDF –æ—Ç—á–µ—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏**: –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã**: –û—á–µ—Ä–µ–¥–∏, –ª–æ–≥–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, —Ä–æ–ª–∏, –ª–∏–º–∏—Ç—ã
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã**: OCR –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã

## üîê –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–æ–≤ (–≤–º–µ—Å—Ç–æ —Ç–∞—Ä–∏—Ñ–æ–≤)

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –±–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø
2. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤ –∞–¥–º–∏–Ω–∫–µ** ‚Üí –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
3. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
   - –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤ (296-–§–ó, CBAM, —É–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥)
   - –õ–∏–º–∏—Ç—ã OCR –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –º–µ—Å—è—Ü)
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
   - –î–æ—Å—Ç—É–ø –∫ API

### –ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫:
```
–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è "–û–û–û –ü—Ä–∏–º–µ—Ä"
‚îú‚îÄ‚îÄ 296-–§–ó –æ—Ç—á–µ—Ç—ã: ‚úÖ –í–∫–ª—é—á–µ–Ω—ã
‚îú‚îÄ‚îÄ CBAM –æ—Ç—á–µ—Ç—ã: ‚ùå –û—Ç–∫–ª—é—á–µ–Ω—ã
‚îú‚îÄ‚îÄ –£–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥: ‚úÖ –í–∫–ª—é—á–µ–Ω
‚îú‚îÄ‚îÄ OCR –ª–∏–º–∏—Ç: 50 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/–º–µ—Å—è—Ü
‚îî‚îÄ‚îÄ API –¥–æ—Å—Ç—É–ø: ‚ùå –û—Ç–∫–ª—é—á–µ–Ω
```

## üöÄ –î–µ–ø–ª–æ–π –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Ç–∞ –∂–µ):
- **vm1 (PostgreSQL)**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + –æ—á–µ—Ä–µ–¥–∏
- **vm2 (–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã)**: Web app + OCR workers
- **SSH —Ç—É–Ω–Ω–µ–ª—å**: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
- `esg-2-web`: Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `esg-2-worker`: OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞  
- `nginx`: Reverse proxy
- `metrics-exporter`: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ESG-2/
‚îú‚îÄ‚îÄ README.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ –∑–∞–¥–∞—á–∏.md                # –ü–æ–¥—Ä–æ–±–Ω—ã–µ backend –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ —Ñ—Ä–æ–Ω—Ç.md                 # –ü–ª–∞–Ω frontend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ backend/                 # Backend –ª–æ–≥–∏–∫–∞ (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)
‚îÇ   ‚îú‚îÄ‚îÄ lib/                # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ api/                # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ workers/            # Background workers
‚îÇ   ‚îî‚îÄ‚îÄ prisma/             # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ frontend/               # Frontend (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ–∑–∂–µ)
    ‚îú‚îÄ‚îÄ components/         # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ pages/              # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ styles/             # –°—Ç–∏–ª–∏ –∏ —Ç–µ–º—ã
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –§–∞–π–ª—ã –∑–∞–¥–∞—á:
- **[–∑–∞–¥–∞—á–∏.md](./–∑–∞–¥–∞—á–∏.md)** - –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **[—Ñ—Ä–æ–Ω—Ç.md](./—Ñ—Ä–æ–Ω—Ç.md)** - –ö–æ–Ω—Ü–µ–ø—Ü–∏—è frontend (–Ω–∞ –±—É–¥—É—â–µ–µ)

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
- –ö–æ–ø–∏—Ä—É–µ–º –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–∑ `../lib/`, `../app/api/`, `../workers/`
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –ø–æ–¥ —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –¥–æ—Å—Ç—É–ø–æ–≤
- –£–±–∏—Ä–∞–µ–º —Ç–∞—Ä–∏—Ñ–Ω—É—é —Å–∏—Å—Ç–µ–º—É

## üéØ Roadmap

### –≠—Ç–∞–ø 1: Backend MVP (4-6 –Ω–µ–¥–µ–ª—å)
1. ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - NextAuth + —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
2. ‚úÖ **OCR —Å–∏—Å—Ç–µ–º–∞** - –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤  
3. ‚úÖ **–û—Ç—á–µ—Ç—ã** - 296-–§–ó –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
4. ‚úÖ **–ê–¥–º–∏–Ω–∫–∞** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏
5. ‚úÖ **–î–µ–ø–ª–æ–π** - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ CI/CD

### –≠—Ç–∞–ø 2: Frontend MVP (3-4 –Ω–µ–¥–µ–ª–∏)
1. üîÑ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI** - React 19 + TailwindCSS 4
2. üîÑ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è UI** - –ï–¥–∏–Ω–∞—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
3. üîÑ **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - Drag & drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
4. üîÑ **–î–∞—à–±–æ—Ä–¥** - –°—Ç–∞—Ç—É—Å—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞–º–∏
5. üîÑ **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è** - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ (2-3 –Ω–µ–¥–µ–ª–∏)
1. üîÑ **CBAM –æ—Ç—á–µ—Ç—ã** - –ï–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
2. üîÑ **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - –í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
3. üîÑ **–£–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥** - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
4. üîÑ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –î–∞—à–±–æ—Ä–¥—ã –∏ –º–µ—Ç—Ä–∏–∫–∏

## üí∞ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)

### –ú–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–æ–≤:
- **–ë–∞–∑–æ–≤—ã–π**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π**: –î–æ–≥–æ–≤–æ—Ä + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
- **Enterprise**: –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è + API –¥–æ—Å—Ç—É–ø

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏:
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –±–µ–∑ –±–∏–ª–ª–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ì–∏–±–∫–æ—Å—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É—Å–ª–æ–≤–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- –§–æ–∫—É—Å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–æ–¥—É–∫—Ç–∞, –∞ –Ω–µ –Ω–∞ —Ç–∞—Ä–∏—Ñ–∞—Ö
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

## üîó –°–≤—è–∑—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º

### Shared components:
- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —ç–º–∏—Å—Å–∏–∏
- OCR –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –†–æ—Å—Å–∏–π—Å–∫–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (CHECKO, RUSENDER)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –û—Ç–ª–∏—á–∏—è:
- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ —Ç–∞—Ä–∏—Ñ–æ–≤
- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏
- –§–æ–∫—É—Å –Ω–∞ MVP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ë—ã—Å—Ç—Ä—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

---

**üéØ –¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π MVP —É–≥–ª–µ—Ä–æ–¥–Ω–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –∑–∞ 2 –º–µ—Å—è—Ü–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –±—ã—Å—Ç—Ä–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã.